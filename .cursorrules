# Flutter 项目规则（Project Rules）

> 本项目为 Flutter 应用，遵循以下开发规范

## 1. 语言与沟通

### 沟通方式
- **优先使用简体中文**回答问题和解释代码
- **问题处理**：遇到问题先给出分析，再提供解决方案
- **代码解释**：一般即可，不需要过度详细

### 代码展示
- 只展示**关键代码片段**，避免整文件贴出
- 基础逻辑无需注释（如变量声明、常见 Widget 使用）
- 复杂逻辑或特殊场景需要简要说明目的

## 2. 技术栈

### Flutter/Dart
- **语言版本**：使用 Dart 3.x，启用 null safety
- **Flutter 版本**：根据项目需要选择稳定版本
- **架构模式**：简单 MVC 即可，业务逻辑简单，不需要过度设计
- **状态管理**：根据项目复杂度选择（Provider、Riverpod、GetX 等）

### 平台支持
- **主要平台**：Android、iOS
- **适配考虑**：使用响应式布局，考虑不同屏幕尺寸
- **版本兼容**：Flutter SDK 版本统一管理，主要关注插件兼容性

## 3. 代码风格

### 命名规范
- **描述性命名**：要求描述性，但不宜过长
- **类名**：PascalCase（如 `UserRepository`、`LoginPage`）
- **方法/变量**：camelCase（如 `fetchUserData()`、`userName`）
- **常量**：UPPER_SNAKE_CASE（如 `MAX_RETRY_COUNT`）
- **私有成员**：使用下划线前缀（如 `_privateMethod()`、`_privateVariable`）

### Dart 代码规范
- 遵循 Dart 官方代码规范（Effective Dart）
- 使用 Dart 现代特性：
  - Null safety
  - Extension methods
  - Collection if/for
  - Pattern matching（Dart 3.0+）
- 优先使用 `const` 构造函数
- 使用 `final` 声明不可变变量

### Widget 设计
- 保持 Widget 简洁，避免过度嵌套
- 复杂 UI 拆分为多个 Widget
- 使用 `StatelessWidget` 优先，需要状态时使用 `StatefulWidget`
- 考虑使用 `const` 构造函数优化性能

## 4. 项目结构

### 目录组织
```
lib/
├── main.dart
├── models/          # 数据模型
├── views/           # UI 页面
├── controllers/     # 业务逻辑控制器（MVC）
├── services/        # 网络请求、数据服务
├── utils/           # 工具类
├── widgets/         # 通用 Widget
└── constants/       # 常量定义
```

### 架构模式
- **简单 MVC**：业务逻辑简单，不需要过度设计
- **Controller**：处理业务逻辑，与 Service 交互
- **View**：负责 UI 展示，通过 Controller 获取数据
- **Model**：数据模型，使用 Data Class

## 5. 依赖管理

### 依赖配置
- 使用 `pubspec.yaml` 管理依赖
- 优先使用官方和社区广泛使用的包
- 定期更新依赖，注意版本兼容性

### 常用依赖
- **网络请求**：`http`、`dio`（根据项目需要选择）
- **状态管理**：根据项目复杂度选择（Provider、Riverpod、GetX 等）
- **路由**：`go_router` 或 `flutter_navigation`
- **本地存储**：`shared_preferences`、`hive` 等
- **图片加载**：`cached_network_image`

## 6. UI 适配

### 屏幕适配
- 使用响应式布局：
  - `MediaQuery` 获取屏幕尺寸
  - `LayoutBuilder` 根据约束调整布局
  - `Flexible`/`Expanded` 弹性布局
- 使用相对单位，避免硬编码尺寸
- 考虑不同屏幕尺寸（手机、平板、折叠屏）

### 主题与样式
- 使用 `ThemeData` 统一管理主题
- 支持深色模式（Dark Mode）
- 颜色、字体、间距等使用主题常量

## 7. 错误处理

### 异常处理
- 网络请求使用 try-catch 处理异常
- 关键操作需要错误处理
- 给用户友好的错误提示

### 日志记录
- 开发环境可以使用 `print` 或 `debugPrint`
- 生产环境使用日志库（如 `logger`）
- 关键错误需要记录日志

## 8. 性能优化

### 性能要求
- **性能标准**：一般即可，不需要极致优化
- **优化原则**：避免明显性能问题，保持代码可维护性

### 优化建议
- 使用 `const` 构造函数减少重建
- 合理使用 `ListView.builder` 处理长列表
- 图片使用缓存（`cached_network_image`）
- 避免在 `build` 方法中执行耗时操作

## 9. 国际化

### 当前状态
- **当前需求**：暂不需要国际化
- **预留空间**：代码设计时尽量给国际化留出实现空间

### 预留方案
- 字符串使用常量或资源文件，避免硬编码
- 使用 `intl` 包预留国际化接口
- UI 布局考虑文本长度变化

## 10. Platform Channel

### 原生交互
- Flutter 与 Android/iOS 原生交互时，使用 Platform Channel
- 确保原生代码的版本兼容性
- Platform Channel 调用需要错误处理
- 定义清晰的接口契约

## 11. 代码质量

### 可维护性
- 保持代码简洁、易读
- 避免过度设计
- 单一职责原则
- 合理拆分 Widget 和功能模块

### 可测试性
- 业务逻辑与 UI 分离（MVC 架构）
- Controller 和 Service 可独立测试
- 关键逻辑可测试

## 12. 版本兼容

### Flutter SDK
- Flutter SDK 版本统一管理
- 关注第三方插件的最低版本要求
- 升级前检查插件兼容性

### 平台版本
- Android：设置最低 SDK 版本（如 API 21+）
- iOS：设置最低版本（如 iOS 12+）
- 使用新 API 前做版本判断（如需要）

## 13. 特殊场景

### 复杂逻辑
- 需要简要注释说明目的
- 特殊用法需要标注（如 Platform Channel、Native 交互等）

### 第三方集成
- 集成第三方 SDK 时，确保版本兼容
- 注意权限申请和隐私政策
- 测试不同平台的表现

