# ShowDoc 核心模块使用说明

## 快速开始

### 1. 安装依赖

```bash
cd core
pip install -r requirements.txt
```

### 2. 运行测试脚本

#### 方式一：完整测试示例

```bash
python test_example.py
```

这个脚本会：
- 初始化客户端
- 获取所有接口数据
- 显示目录结构和统计信息
- 可选导出为 JSON 文件

#### 方式二：简单测试

```bash
python test_simple.py
```

这个脚本提供快速功能验证。

### 3. 在代码中使用

```python
from core import ShowDocClient

# 初始化客户端（方式1：使用密码自动登录，默认密码 123456）
base_url = "https://doc.cqfengli.com/web/#/90/"
client = ShowDocClient(base_url, password="123456")

# 或方式2：使用 Cookie
cookie = "think_language=zh-CN; PHPSESSID=xxx"
client = ShowDocClient(base_url, cookie=cookie)

# 获取所有接口数据
api_tree = client.get_all_apis()

# 或者获取指定节点
api_tree = client.get_all_apis(node_name="订单")
```

## 参数说明

### base_url

ShowDoc 文档页面的完整 URL，例如：
- `https://doc.cqfengli.com/web/#/90/`

URL 中会包含项目 ID（如上面的 `90`），模块会自动提取。

### cookie（可选）

访问 ShowDoc 所需的认证 Cookie，格式：
```
think_language=zh-CN; PHPSESSID=xxx
```

**如何获取 Cookie：**
1. 在浏览器中登录 ShowDoc
2. 打开开发者工具（F12）
3. 在 Network 标签中查看任意请求
4. 复制 Request Headers 中的 `Cookie` 值

### password（可选，默认: "123456"）

项目访问密码，如果提供且 cookie 为空，将自动进行验证码登录。

**推荐使用方式：**
```python
# 使用默认密码自动登录（无需手动获取 Cookie）
client = ShowDocClient(base_url, password="123456")
```

### node_name

节点（分类）名称：
- `None` 或 `"全部"` 或 `"all"`：获取所有节点
- 具体名称（如 `"订单"`）：只获取该节点及其子节点

## 测试步骤

1. **准备参数**
   - 获取你的 ShowDoc URL
   - 获取你的 Cookie

2. **修改测试脚本**
   
   打开 `test.py`，修改以下变量：
   ```python
   BASE_URL = "你的 ShowDoc URL"
   COOKIE = None  # 可选，如果提供则使用 Cookie 认证
   PASSWORD = "123456"  # 默认密码，如果未提供 COOKIE 则使用密码自动登录
   ```

3. **运行测试**
   ```bash
   python test_simple.py
   ```

4. **查看结果**
   - 脚本会输出分类列表和页面信息
   - 如果有错误，会显示错误信息

## 常见问题

### 1. 认证失败

**错误信息：** `ShowDocAuthError: 认证失败`

**解决方法：**
- 检查 Cookie 是否有效
- 重新登录 ShowDoc 获取新的 Cookie
- 确保 Cookie 格式正确（使用分号和空格分隔）

### 2. 节点不存在

**错误信息：** `ShowDocNotFoundError: 未找到名称为 'xxx' 的节点`

**解决方法：**
- 检查节点名称是否正确（区分大小写）
- 使用 `get_all_apis()` 不传参数，先查看所有节点名称

### 3. 网络连接失败

**错误信息：** `ShowDocNetworkError: 连接失败`

**解决方法：**
- 检查网络连接
- 确认 ShowDoc 服务器地址是否正确
- 检查是否有防火墙或代理限制

## 输出数据格式

获取的数据结构：

```python
ApiTree
├── item_info (ItemInfo)
│   ├── item_id
│   └── item_name
└── categories (List[Category])
    ├── Category
    │   ├── cat_id
    │   ├── cat_name
    │   ├── pages (List[Page])
    │   │   └── Page
    │   │       ├── page_id
    │   │       ├── page_title
    │   │       └── api_info (ApiDefinition)
    │   │           ├── method (GET/POST等)
    │   │           ├── url
    │   │           ├── request
    │   │           └── response
    │   └── children (List[Category])  # 子分类
```

## 导出为 JSON

```python
import json

api_tree = client.get_all_apis()
data = api_tree.to_dict()

# 保存到文件
with open('showdoc_data.json', 'w', encoding='utf-8') as f:
    json.dump(data, f, ensure_ascii=False, indent=2)
```

## 下一步

完成测试后，你可以：
- 将数据导出为 JSON
- 封装为 MCP 服务
- 转换为 Android 实体类和 Retrofit Service 配置
- 生成其他格式的代码

